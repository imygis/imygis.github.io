!function(){"use strict";var e=window.P,t=window.OSG,r=t.osg,i=t.osgViewer,o=t.osgDB,a=t.osgShader,s=window.Object,n=window.$,d=function(){this._config={},this._texturesNames=[],this._meshNames=[],this._shaderNames=[],this._shaderPath="",this._mediaPath="../media/",this._viewer=void 0,this._gui=void 0,this._shaderProcessor=void 0,this._canvas=void 0,this._root=new r.Node,this._root.setName("root"),this._debugNodeRTT=new r.Node,this._debugNodeRTT.setName("debugNodeRTT"),this._debugNodeRTT.getOrCreateStateSet().setRenderBinDetails(1e3,"RenderBin"),this._root.addChild(this._debugNodeRTT),this._debugProgram=void 0,this._debugDepthProgram=void 0};d.prototype={run:function(e){this.setConfigFromOptionsURL(),this._canvas=document.getElementById("View"),this._viewer=new i.Viewer(this._canvas,e),this._viewer.init(),this._viewer.getCamera().setClearColor([0,0,0,0]),this._viewer.setupManipulator(),this.createScene(),this.initDatGUI(),this._viewer.setSceneData(this._root),this._viewer.getManipulator().computeHomePosition(),this._viewer.run()},initDatGUI:function(){this._gui=new window.dat.GUI},getRootNode:function(){return this._root},setConfigFromOptionsURL:function(){var e={};window.location.search.substr(1).split("&").forEach((function(t){e[t.split("=")[0]]=t.split("=")[1]}));for(var t=s.keys(e),i=0;i<t.length;i++){var o=t[i],a=e[o];if(a&&a.length)try{var n=JSON.parse(e[o]);!isNaN(parseFloat(n))&&isFinite(n)&&(n=parseFloat(n)),this._config[o]=n}catch(e){this._config[o]=a,r.log("cannot parse url option: "+o+" = "+a)}}},readTextures:function(e){var t=e||this._textureNames,r=this._mediaPath+"textures/";return t.map((function(e){return r+e})).map((function(e){return o.readImageURL(e)}))},setShaderPath:function(e){this._shaderPath=e},readShaders:function(t){this._shaderProcessor=new a.ShaderProcessor;var r=t||this._shaderNames,i=r.map(function(e){return this._shaderPath+e}.bind(this)),o=[];return i.forEach(function(t){o.push(e.resolve(n.get(t)))}.bind(this)),e.all(o).then(function(e){var t={};r.forEach((function(r,i){t[r]=e[i]})),this._shaderProcessor.addShaders(t)}.bind(this))},createShader:function(e,t,i,o){var a=this._shaderProcessor.getShader(e,t),s=this._shaderProcessor.getShader(i,o);return new r.Program(new r.Shader("VERTEX_SHADER",a),new r.Shader("FRAGMENT_SHADER",s))},hideDebugTextureList:function(){this._debugNodeRTT.setNodeMask(0)},showDebugTextureList:function(){this._debugNodeRTT.setNodeMask(-1)},toggleShowHideDebugTextureList:function(){0===this._debugNodeRTT.getNodeMask()?this.showDebugTextureList():this.hideDebugTextureList()},createDebugTextureList:function(e,t){var i=this._canvas.width/this._canvas.height,o=Math.floor(.3*this._canvas.width),a={x:0,y:100,w:o,h:Math.floor(o/i),horizontal:!0,screenW:this._canvas.width,screenH:this._canvas.height};t&&r.extend(a,t);var s=this._debugNodeRTT;s.setNodeMask(-1),s.removeChildren();var n=new r.Node;n.setName("debugComposerNode"),n.setCullingActive(!1);var d=new r.Camera;d.setName("composerDebugCamera"),s.addChild(d);var h=d.getProjectionMatrix();r.mat4.ortho(h,0,a.screenW,0,a.screenH,-5,5);var u=d.getViewMatrix();r.mat4.fromTranslation(u,[0,0,0]),d.setRenderOrder(r.Camera.NESTED_RENDER,0),d.setReferenceFrame(r.Transform.ABSOLUTE_RF),d.addChild(n);var c=a.x,g=a.y;n.getOrCreateStateSet().setAttributeAndModes(new r.Depth("DISABLE"));for(var v=0,_=e.length;v<_;v++){var m=e[v];if(m){var l=r.createTexturedQuadGeometry(c,g,0,a.w,0,0,0,a.h,0),f=l.getOrCreateStateSet();l.setName("debugComposerGeometry"+v),f.setTextureAttributeAndModes(0,m),m.getInternalFormat()!==r.Texture.DEPTH_COMPONENT?f.setAttributeAndModes(this.getDebugProgram()):f.setAttributeAndModes(this.getDebugDepthProgram()),n.addChild(l),a.horizontal?c+=a.w+2:g+=a.h+2}}},getDebugProgram:function(){if(void 0===this._debugProgram){var e=["#define SHADER_NAME DEBUG_RTT","attribute vec3 Vertex;","attribute vec2 TexCoord0;","varying vec2 vTexCoord0;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","void main(void) {","  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex,1.0));","  vTexCoord0 = TexCoord0;","}",""].join("\n"),t=["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float;","#endif","#define SHADER_NAME DEBUG_RTT","varying vec2 vTexCoord0;","uniform sampler2D Texture0;","","void main (void)","{","  vec2 uv = vTexCoord0;","  gl_FragColor = vec4(texture2D(Texture0, uv));","}",""].join("\n");this._debugProgram=new r.Program(new r.Shader("VERTEX_SHADER",e),new r.Shader("FRAGMENT_SHADER",t))}return this._debugProgram},getDebugDepthProgram:function(){if(void 0===this._debugDepthProgram){var e=["#define SHADER_NAME DEBUG_RTT","attribute vec3 Vertex;","attribute vec2 TexCoord0;","varying vec2 vTexCoord0;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","void main(void) {","  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex,1.0));","  vTexCoord0 = TexCoord0;","}",""].join("\n"),t=["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float;","#endif","#define SHADER_NAME DEBUG_RTT","varying vec2 vTexCoord0;","uniform sampler2D Texture0;","","void main (void)","{","  vec2 uv = vTexCoord0;","  vec4 color = vec4(texture2D(Texture0, uv));","  gl_FragColor = vec4( color.r, color.r, color.r, 1.0 );","}",""].join("\n");this._debugDepthProgram=new r.Program(new r.Shader("VERTEX_SHADER",e),new r.Shader("FRAGMENT_SHADER",t))}return this._debugDepthProgram},createModel:function(e){var t=new r.MatrixTransform;if(e){o.readNodeURL(e).then((function(e){t.addChild(e)}))}else{var i=r.createTexturedBoxGeometry(0,0,0,10,10,10);t.addChild(i)}return t},getOrCreateModel:function(e){return this._model?this._model.removeChildren():this._model=new r.MatrixTransform,this._model.addChild(this.createModel(e)),this._model},createScene:function(){this._root.addChild(this.getOrCreateModel())}},window.ExampleOSGJS=d}();